~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Title: XOOPS CMS 1.x <== SQL Injection Vulnerability
# Google Dork: intext:"Xoops Project" + inurl:/modules/cjaycontent/index.php?id=   OR  inurl:/modules/cjaycontent/index.php?id=
# Author: Max Ethical Savior ==> Break Security Hackers Team
# Contact: anonymousedodemex@gmail.com
# Date: Friday, 05/31/2013
# Vendor: http://www.xoops.org/
# Version: 1.x
# Tested on: Windows and Linux (Backtrack 5 r3)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 Sql Injection Vulnerability in "/modules/cjaycontent/index.php"
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$id = $_GET['id'];
include("../../mainfile.php");
$fc_start_id =$id;

if($xoopsConfig['startpage'] == "cjaycontent"){
	$xoopsOption['show_rblock'] =1;
	include(XOOPS_ROOT_PATH."/header.php");
	$id = $fc_start_id;
	fc_wrap($id);
	include (XOOPS_ROOT_PATH."/footer.php");
	}
else{
	$xoopsOption['show_rblock'] =1;
	include (XOOPS_ROOT_PATH."/header.php");
	fc_wrap($id);
	include (XOOPS_ROOT_PATH."/footer.php");
}
	
// run wrapper
//*****************************************************************************************
//*** Functions-declaration ***************************************************************
//*****************************************************************************************
function fc_wrap($id){
	global $xoopsDB, $xoopsConfig, $xoopsTheme, $xoopsOption;
	OpenTable();

	//query Database (returns an array)
	$fc_item = fc_query_db_on_id($id);

	//$id exists?
	if( isset($fc_item['adress']) && $fc_item['adress'] != "" ){
		// include content
		$fc_include = XOOPS_ROOT_PATH."/modules/cjaycontent/content/".$fc_item['adress'];
		if (file_exists($fc_include)){
			include($fc_include);
			// increment hitcounter (hits)
			$res = $xoopsDB->queryF("UPDATE ".$xoopsDB->prefix()."_cjaycontent SET hits=hits+1 WHERE id=\"".$id."\"");
		}
		else{
			echo _CC_FILENOTFOUND.$fc_include;
		}
	}
	else{
		$fc_include = XOOPS_ROOT_PATH."/modules/cjaycontent/content/DO_NOT_DELETE.php";
		if (file_exists($fc_include)){
			include($fc_include);
			// increment hitcounter (hits)
			$res = $xoopsDB->queryF("UPDATE ".$xoopsDB->prefix()."_cjaycontent SET hits=hits+1 WHERE id=\"".$id."\"");
		}
		else{
			echo _CC_FILENOTFOUND.$fc_include;
		}
	}

	CloseTable();
	
	return 1;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- Vulnerable Code Snippet:

as we can see the GET method always refers to the parameter "ID" and processes it directly without going through any filter safe.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Exploit:
http://www.[SERVER]/modules/cjaycontent/index.php?id=[SQLi]

Using Havij or other automated SQL Injection tool for dump database. (Username= uname and  Password= pass).

Panel Admin: http://www.[SERVER]/modules/cjaycontent/admin

once entered the admin backend and click on the button "ibs_content" and then on "Manage Files" and select "1" and the shell up now ;)

Now look for the shell in the directory:

http://www.[SERVER]/modules/cjaycontent/content/[SHELL.PHP]


enjoy ;)!!!!


Followme on twitter: @max_ethical_s
Break Security Hackers Team
www.breaksechackers.hol.es ==> @BreakSecurityH

Regards!!!!
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
